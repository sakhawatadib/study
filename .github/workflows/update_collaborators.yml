name: Update collaborators

on:
  pull_request:
    types:
      - closed

jobs:
  build:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true
    steps:
    - uses: actions/checkout@v2
    - name: Get PR submitter
      id: pr
      run: |
        PR_USER=$(jq --raw-output .pull_request.user.login "$GITHUB_EVENT_PATH")
        echo "::set-output name=pr_user::$PR_USER"
    - name: Update collaborators.md
      run: |
        echo "[$PR_USER](https://github.com/$PR_USER)" >> collaborators.md
    - name: Commit and push
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git commit -am "Add ${{ steps.pr.outputs.pr_user }} to collaborators.md"
        git push
